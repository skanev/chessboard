# coding: utf-8
require 'spec_helper'

module Chessboard
  describe SpecSupport::BoardParser do
    it "can parse graphical representation of a board" do
      board = parse_board <<-END
        ┌───┬───┬───┬───┬───┬───┬───┬───┐
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │ ♟ │ ♞ │ ♝ │ ♜ │ ♛ │ ♚ │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │ ♙ │ ♘ │ ♗ │ ♖ │ ♕ │ ♔ │   │   │
        └───┴───┴───┴───┴───┴───┴───┴───┘
      END

      board.at(0, 0).should eq :white_pawn
      board.at(0, 1).should eq :white_knight
      board.at(0, 2).should eq :white_bishop
      board.at(0, 3).should eq :white_rook
      board.at(0, 4).should eq :white_queen
      board.at(0, 5).should eq :white_king

      board.at(1, 0).should eq :black_pawn
      board.at(1, 1).should eq :black_knight
      board.at(1, 2).should eq :black_bishop
      board.at(1, 3).should eq :black_rook
      board.at(1, 4).should eq :black_queen
      board.at(1, 5).should eq :black_king
    end

    it "can parse graphical representation of a board" do
      board = parse_board <<-END
        ┌───┬───┬───┬───┬───┬───┬───┬───┐
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │( )│   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │( )│   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │[♙]│   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        └───┴───┴───┴───┴───┴───┴───┴───┘
      END

      board.selected_square.should eq [1, 4]
      board.marked_squares.should =~ [[2, 4], [3, 4]]
    end

    it "raises an error on malformed boards" do
      expect_invalid_board '---'

      expect_invalid_board <<-END
        ┌───┬───┬───┬───┬───┬───┬───┐
        │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │
        └───┴───┴───┴───┴───┴───┴───┘
      END

      expect_invalid_board <<-END
        ┌───┬───┬───┬───┬───┬───┬───┬───┐
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        └───┴───┴───┴───┴───┴───┴───┴───┘
      END

      expect_invalid_board <<-END
        ┌───┬───┬───┬───┬───┬───┬───┬───┐
        │ x │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        ├───┼───┼───┼───┼───┼───┼───┼───┤
        │   │   │   │   │   │   │   │   │
        └───┴───┴───┴───┴───┴───┴───┴───┘
      END
    end

    def expect_invalid_board(text)
      expect { parse_board text }.to raise_error('Malformed board')
    end
  end
end
